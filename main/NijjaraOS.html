<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nijjara-OS | Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ…Ù‡ÙŠØ¯...</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap"
      rel="stylesheet"
    />

    <script>
      // Debug flag injected from Apps Script template (set in Code.js doGet)
      // Will be an empty string when not provided.
      window.__DEBUG__ =
        '<?!= JSON.stringify(typeof debug !== "undefined" ? debug : "") ?>';
    </script>

    <style>
      /* --- II. CSS STYLES --- */

      :root {
        --font-family: "Cairo", sans-serif;
        --font-mono: "Share Tech Mono", monospace;
        --color-bg-dark-matter: #001F3F;
        --color-bg-glass: rgba(25, 28, 48, 0.6);
        --color-border-glass: rgba(255, 255, 255, 0.15);
        --color-text: #e0e0e0;
        --color-text-muted: #aaa;
        --color-accent-primary: #4FC3F7;
        --color-accent-secondary: #29B6F6;
        --color-accent-red: #d93030;
        --color-accent-green: #30d970;
        --shadow-depth-md: 0 5px 15px rgba(0, 0, 0, 0.3);
        --shadow-depth-lg: 0 10px 30px rgba(0, 0, 0, 0.4);
      }

      /* --- Global Reset & Body --- */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        background-color: var(--color-bg-dark-matter);
        color: var(--color-text);
        font-family: var(--font-family);
        direction: rtl;
      }

      /* --- 1. BOOT SCREEN (Login) --- */
      #boot-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        background: #000;
        z-index: 1000;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        transition: opacity 1s ease-out, visibility 1s ease-out;
      }
      #boot-log {
        width: 450px;
        font-family: var(--font-mono);
        font-size: 1rem;
        color: var(--color-accent-green);
      }
      #boot-log p {
        margin-bottom: 5px;
        white-space: pre;
      }
      .login-box {
      display: none;
      flex-direction: column;
      width: 350px;
      margin-top: 20px;
      padding: 25px;
      border: 2px solid var(--color-accent-primary);
      box-shadow: var(--shadow-depth-lg);
      background: var(--color-bg-glass);
      border-radius: 12px;
    }
    .login-box h2 {
      font-family: var(--font-family);
      text-align: center;
      color: var(--color-accent-primary);
      margin-bottom: 20px;
    }
    .login-box input {
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid var(--color-text-muted);
      color: var(--color-text);
      padding: 12px;
      margin-bottom: 15px;
      font-family: var(--font-family);
      font-size: 1rem;
      text-align: right;
      border-radius: 5px;
      transition: all 0.2s ease;
    }
    .login-box input:focus {
      outline: none;
      border-color: var(--color-accent-primary);
      box-shadow: 0 0 12px var(--color-accent-secondary), inset 0 0 0 1px var(--color-accent-primary);
      background: rgba(0, 0, 0, 0.7);
      transform: translateY(-1px);
    }
    .login-box button {
      background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-secondary));
      border: none;
      color: #fff;
      padding: 12px;
      font-family: var(--font-family);
      font-weight: 700;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 5px;
    }
    .login-box button:hover {
      background: linear-gradient(135deg, var(--color-accent-secondary), var(--color-accent-primary));
      box-shadow: var(--shadow-depth-md);
      transform: translateY(-2px);
      box-shadow: 0 0 20px var(--color-accent-secondary);
    }
    
    /* --- 3D CUBE LOGIN FORM STYLING --- */
    .login-box-3d {
      display: none;
      flex-direction: column;
      width: 320px;
      margin: 0 auto;
      padding: 64px 15px 24px;
      position: relative;
      z-index: 10;
    }
    .login-box-3d .control {
      margin: 0 0 24px;
      position: relative;
    }
    .login-box-3d .control h1 {
      font-size: 23px;
      color: var(--color-accent-primary);
      text-align: center;
      margin-bottom: 30px;
      font-family: var(--font-mono);
      letter-spacing: 0.05em;
    }
    .login-box-3d .control input {
      width: 100%;
      padding: 14px 16px;
      border: 0;
      background: transparent;
      color: var(--color-text);
      font-family: var(--font-mono);
      letter-spacing: 0.05em;
      font-size: 16px;
      text-align: right;
    }
    .login-box-3d .control input:hover,
    .login-box-3d .control input:focus {
      outline: none;
      border: 0;
    }
    .login-box-3d .btn {
      width: 100%;
      display: block;
      padding: 14px 16px;
      background: transparent;
      outline: none;
      border: 0;
      color: var(--color-text);
      letter-spacing: 0.1em;
      font-weight: bold;
      font-family: var(--font-mono);
      font-size: 16px;
      cursor: pointer;
    }
    
    /* 3D Cube Block Styling */
    .block-cube {
      position: relative;
    }
    .block-cube .bg-top {
      position: absolute;
      height: 10px;
      background: linear-gradient(90deg, var(--color-bg-dark-matter) 0%, var(--color-accent-primary) 37%, var(--color-accent-secondary) 94%);
      bottom: 100%;
      left: 5px;
      right: -5px;
      transform: skew(-45deg, 0);
      margin: 0;
    }
    .block-cube .bg-top .bg-inner {
      bottom: 0;
    }
    .block-cube .bg {
      position: absolute;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, var(--color-bg-dark-matter) 0%, var(--color-accent-primary) 37%, var(--color-accent-secondary) 94%);
    }
    .block-cube .bg-right {
      position: absolute;
      background: var(--color-accent-secondary);
      top: -5px;
      z-index: 0;
      bottom: 5px;
      width: 10px;
      left: 100%;
      transform: skew(0, -45deg);
    }
    .block-cube .bg-right .bg-inner {
      left: 0;
    }
    .block-cube .bg .bg-inner {
      transition: all 0.2s ease-in-out;
    }
    .block-cube .bg-inner {
      background: var(--color-bg-dark-matter);
      position: absolute;
      left: 2px;
      top: 2px;
      right: 2px;
      bottom: 2px;
    }
    .block-cube.block-input input:focus ~ .bg-right .bg-inner,
    .block-cube.block-input input:focus ~ .bg-top .bg-inner,
    .block-cube.block-input input:focus ~ .bg-inner .bg-inner {
      top: 100%;
      background: rgba(79, 195, 247, 0.5);
    }
    .block-cube.block-input .bg-top,
    .block-cube.block-input .bg-right,
    .block-cube.block-input .bg {
      background: rgba(79, 195, 247, 0.5);
      transition: background 0.2s ease-in-out;
    }
    .block-cube.block-input .bg-right .bg-inner,
    .block-cube.block-input .bg-top .bg-inner {
      transition: all 0.2s ease-in-out;
    }
    .block-cube.block-input:focus .bg-top,
    .block-cube.block-input:focus .bg-right,
    .block-cube.block-input:focus .bg,
    .block-cube.block-input:hover .bg-top,
    .block-cube.block-input:hover .bg-right,
    .block-cube.block-input:hover .bg {
      background: rgba(79, 195, 247, 0.8);
    }
    .block-cube.block-cube-hover:focus .bg .bg-inner,
    .block-cube.block-cube-hover:hover .bg .bg-inner {
      top: 100%;
    }
    
    /* --- PARTICLE ORB BACKGROUND --- */
    .particle-orbs {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
      overflow: hidden;
    }
    .particle-orbs .wrap {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      transform-style: preserve-3d;
      perspective: 1000px;
      animation: rotate 14s infinite linear;
    }
    @keyframes rotate {
      100% {
        transform: rotateY(360deg) rotateX(360deg);
      }
    }
    .particle-orbs .c {
      position: absolute;
      width: 2px;
      height: 2px;
      border-radius: 50%;
      opacity: 0;
    }
    /* Generate particle orb animations with NijjaraOS theme colors */
    .particle-orbs .c:nth-child(1) {
      animation: orbit1 14s infinite;
      animation-delay: 0.01s;
      background-color: var(--color-accent-primary);
    }
    @keyframes orbit1 {
      20% { opacity: 1; }
      30% { transform: rotateZ(-203deg) rotateY(212deg) translateX(100px) rotateZ(203deg); }
      80% { transform: rotateZ(-203deg) rotateY(212deg) translateX(100px) rotateZ(203deg); opacity: 1; }
      100% { transform: rotateZ(-203deg) rotateY(212deg) translateX(300px) rotateZ(203deg); }
    }
    .particle-orbs .c:nth-child(2) {
      animation: orbit2 14s infinite;
      animation-delay: 0.02s;
      background-color: var(--color-accent-secondary);
    }
    @keyframes orbit2 {
      20% { opacity: 1; }
      30% { transform: rotateZ(-1deg) rotateY(240deg) translateX(100px) rotateZ(1deg); }
      80% { transform: rotateZ(-1deg) rotateY(240deg) translateX(100px) rotateZ(1deg); opacity: 1; }
      100% { transform: rotateZ(-1deg) rotateY(240deg) translateX(300px) rotateZ(1deg); }
    }
    .particle-orbs .c:nth-child(3) {
      animation: orbit3 14s infinite;
      animation-delay: 0.03s;
      background-color: var(--color-accent-primary);
    }
    @keyframes orbit3 {
      20% { opacity: 1; }
      20% { opacity: 1; }
      30% { transform: rotateZ(-199deg) rotateY(358deg) translateX(100px) rotateZ(199deg); }
      80% { transform: rotateZ(-199deg) rotateY(358deg) translateX(100px) rotateZ(199deg); opacity: 1; }
      100% { transform: rotateZ(-199deg) rotateY(358deg) translateX(300px) rotateZ(199deg); }
    }
    .particle-orbs .c:nth-child(4) {
      animation: orbit4 14s infinite;
      animation-delay: 0.04s;
      background-color: var(--color-accent-secondary);
    }
    @keyframes orbit4 {
      20% { opacity: 1; }
      30% { transform: rotateZ(-152deg) rotateY(200deg) translateX(100px) rotateZ(152deg); }
      80% { transform: rotateZ(-152deg) rotateY(200deg) translateX(100px) rotateZ(152deg); opacity: 1; }
      100% { transform: rotateZ(-152deg) rotateY(200deg) translateX(300px) rotateZ(152deg); }
    }
    /* Continue pattern for more particles... */
    .particle-orbs .c:nth-child(5) {
      animation: orbit5 14s infinite;
      animation-delay: 0.05s;
      background-color: var(--color-accent-primary);
    }
    .particle-orbs .c:nth-child(6) {
      animation: orbit6 14s infinite;
      animation-delay: 0.06s;
      background-color: var(--color-accent-secondary);
    }
    .particle-orbs .c:nth-child(7) {
      animation: orbit7 14s infinite;
      animation-delay: 0.07s;
      background-color: var(--color-accent-primary);
    }
    .particle-orbs .c:nth-child(8) {
      animation: orbit8 14s infinite;
      animation-delay: 0.08s;
      background-color: var(--color-accent-secondary);
    }
    /* Add more particles as needed */
    .particle-orbs .c:nth-child(n+9) {
      animation: orbit9 14s infinite;
      background-color: var(--color-accent-primary);
      opacity: 0.6;
    }
    @keyframes orbit9 {
      20% { opacity: 0.8; }
      30% { transform: rotateZ(-45deg) rotateY(180deg) translateX(120px) rotateZ(45deg); }
      80% { transform: rotateZ(-45deg) rotateY(180deg) translateX(120px) rotateZ(45deg); opacity: 0.8; }
      100% { transform: rotateZ(-45deg) rotateY(180deg) translateX(350px) rotateZ(45deg); }
    }
    
    /* Center the login form above the particle background */
    #boot-screen {
      position: relative;
      z-index: 5;
    }
    .login-box-3d {
      z-index: 10;
    }
      #login-feedback {
        color: var(--color-accent-red);
        text-align: center;
        margin-top: 15px;
        height: 20px;
      }

      /* --- 2. NIJJARA-OS INTERFACE (The "Desktop") --- */
      #nijjara-os {
        display: none;
        height: 100vh;
        width: 100vw;
        position: relative;
      }

      /* --- 2.1 The "Holo-Deck" (Desktop Background) --- */
      #holo-deck {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
      }
      
      /* --- PARTICLE ORB DESKTOP BACKGROUND --- */
      .particle-desktop-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
        overflow: hidden;
        background: radial-gradient(
          ellipse at 50% 50%,
          #003366 0%,
          var(--color-bg-dark-matter) 70%,
          #000814 100%
        );
      }
      .particle-desktop-bg .wrap {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        transform-style: preserve-3d;
        perspective: 1000px;
        animation: rotate 14s infinite linear;
      }
      @keyframes rotate {
        100% {
          transform: rotateY(360deg) rotateX(360deg);
        }
      }
      .particle-desktop-bg .c {
        position: absolute;
        width: 2px;
        height: 2px;
        border-radius: 50%;
        opacity: 0;
      }
      /* Generate particle orb animations with NijjaraOS theme colors */
      .particle-desktop-bg .c:nth-child(1) {
        animation: orbit1 14s infinite;
        animation-delay: 0.01s;
        background-color: var(--color-accent-primary);
      }
      @keyframes orbit1 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-203deg) rotateY(212deg) translateX(100px) rotateZ(203deg); }
        80% { transform: rotateZ(-203deg) rotateY(212deg) translateX(100px) rotateZ(203deg); opacity: 1; }
        100% { transform: rotateZ(-203deg) rotateY(212deg) translateX(300px) rotateZ(203deg); }
      }
      .particle-desktop-bg .c:nth-child(2) {
        animation: orbit2 14s infinite;
        animation-delay: 0.02s;
        background-color: var(--color-accent-secondary);
      }
      @keyframes orbit2 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-1deg) rotateY(240deg) translateX(100px) rotateZ(1deg); }
        80% { transform: rotateZ(-1deg) rotateY(240deg) translateX(100px) rotateZ(1deg); opacity: 1; }
        100% { transform: rotateZ(-1deg) rotateY(240deg) translateX(300px) rotateZ(1deg); }
      }
      .particle-desktop-bg .c:nth-child(3) {
        animation: orbit3 14s infinite;
        animation-delay: 0.03s;
        background-color: var(--color-accent-primary);
      }
      @keyframes orbit3 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-199deg) rotateY(358deg) translateX(100px) rotateZ(199deg); }
        80% { transform: rotateZ(-199deg) rotateY(358deg) translateX(100px) rotateZ(199deg); opacity: 1; }
        100% { transform: rotateZ(-199deg) rotateY(358deg) translateX(300px) rotateZ(199deg); }
      }
      .particle-desktop-bg .c:nth-child(4) {
        animation: orbit4 14s infinite;
        animation-delay: 0.04s;
        background-color: var(--color-accent-secondary);
      }
      @keyframes orbit4 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-152deg) rotateY(200deg) translateX(100px) rotateZ(152deg); }
        80% { transform: rotateZ(-152deg) rotateY(200deg) translateX(100px) rotateZ(152deg); opacity: 1; }
        100% { transform: rotateZ(-152deg) rotateY(200deg) translateX(300px) rotateZ(152deg); }
      }
      .particle-desktop-bg .c:nth-child(5) {
        animation: orbit5 14s infinite;
        animation-delay: 0.05s;
        background-color: var(--color-accent-primary);
      }
      @keyframes orbit5 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-294deg) rotateY(110deg) translateX(100px) rotateZ(294deg); }
        80% { transform: rotateZ(-294deg) rotateY(110deg) translateX(100px) rotateZ(294deg); opacity: 1; }
        100% { transform: rotateZ(-294deg) rotateY(110deg) translateX(300px) rotateZ(294deg); }
      }
      .particle-desktop-bg .c:nth-child(6) {
        animation: orbit6 14s infinite;
        animation-delay: 0.06s;
        background-color: var(--color-accent-secondary);
      }
      @keyframes orbit6 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-135deg) rotateY(198deg) translateX(100px) rotateZ(135deg); }
        80% { transform: rotateZ(-135deg) rotateY(198deg) translateX(100px) rotateZ(135deg); opacity: 1; }
        100% { transform: rotateZ(-135deg) rotateY(198deg) translateX(300px) rotateZ(135deg); }
      }
      .particle-desktop-bg .c:nth-child(7) {
        animation: orbit7 14s infinite;
        animation-delay: 0.07s;
        background-color: var(--color-accent-primary);
      }
      @keyframes orbit7 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-93deg) rotateY(343deg) translateX(100px) rotateZ(93deg); }
        80% { transform: rotateZ(-93deg) rotateY(343deg) translateX(100px) rotateZ(93deg); opacity: 1; }
        100% { transform: rotateZ(-93deg) rotateY(343deg) translateX(300px) rotateZ(93deg); }
      }
      .particle-desktop-bg .c:nth-child(8) {
        animation: orbit8 14s infinite;
        animation-delay: 0.08s;
        background-color: var(--color-accent-secondary);
      }
      @keyframes orbit8 {
        20% { opacity: 1; }
        30% { transform: rotateZ(-337deg) rotateY(182deg) translateX(100px) rotateZ(337deg); }
        80% { transform: rotateZ(-337deg) rotateY(182deg) translateX(100px) rotateZ(337deg); opacity: 1; }
        100% { transform: rotateZ(-337deg) rotateY(182deg) translateX(300px) rotateZ(337deg); }
      }
      /* Additional particles for richer effect */
      .particle-desktop-bg .c:nth-child(n+9) {
        animation: orbit9 14s infinite;
        background-color: var(--color-accent-primary);
        opacity: 0.6;
      }
      @keyframes orbit9 {
        20% { opacity: 0.8; }
        30% { transform: rotateZ(-45deg) rotateY(180deg) translateX(120px) rotateZ(45deg); }
        80% { transform: rotateZ(-45deg) rotateY(180deg) translateX(120px) rotateZ(45deg); opacity: 0.8; }
        100% { transform: rotateZ(-45deg) rotateY(180deg) translateX(350px) rotateZ(45deg); }
      }

      /* --- 2.3 App Windows --- */
      .app-window {
        position: absolute;
        width: 600px;
        height: 400px;
        z-index: 10;
        background: var(--color-bg-glass);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid var(--color-border-glass);
        border-radius: 12px;
        box-shadow: var(--shadow-depth-lg);
        animation: materialize 0.5s ease-out;
        resize: both;
        overflow: hidden;
        min-width: 300px;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        transition: top 0.3s ease, left 0.3s ease, width 0.3s ease,
          height 0.3s ease;
      }
      @keyframes materialize {
        from {
          opacity: 0;
          transform: scale(0.7) rotateY(45deg);
        }
        to {
          opacity: 1;
          transform: scale(1) rotateY(0);
        }
      }
      .window-header {
        width: 100%;
        height: 35px;
        background: rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 10px;
        cursor: grab;
        flex-shrink: 0;
      }
      .window-header:active {
        cursor: grabbing;
      }
      .window-title {
        font-weight: 700;
        color: var(--color-text);
      }
      .window-controls {
        display: flex;
        gap: 8px;
        flex-grow: 1;
        justify-content: space-between;
      }
      .window-controls-left {
        display: flex;
        gap: 8px;
      }
      .window-controls-right {
        display: flex;
        gap: 8px;
      }
      .window-controls button {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        line-height: 1;
        font-weight: bold;
        color: #000;
      }
      .win-btn-icon {
        background: none;
        color: var(--color-text-muted);
        width: 20px;
        height: 20px;
        border-radius: 4px;
      }
      .win-btn-icon svg {
        width: 12px;
        height: 12px;
        stroke: var(--color-text-muted);
        stroke-width: 3;
      }
      .win-btn-icon:hover {
        background: rgba(255, 255, 255, 0.2);
      }
      .win-btn-icon:hover svg {
        stroke: var(--color-text);
      }
      .btn-close {
        background: var(--color-accent-red);
      }
      .btn-min {
        background: #f0a000;
      }
      .btn-max {
        background: var(--color-accent-green);
      }
      .window-content {
        padding: 20px;
        flex-grow: 1;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: var(--color-border-glass) transparent;
      }
      .window-content::-webkit-scrollbar {
        width: 8px;
      }
      .window-content::-webkit-scrollbar-track {
        background: transparent;
      }
      .window-content::-webkit-scrollbar-thumb {
        background-color: var(--color-border-glass);
        border-radius: 8px;
      }
      .window-content h3 {
        color: var(--color-accent-primary);
        border-bottom: 1px solid var(--color-border-glass);
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .window-content p {
        margin-bottom: 10px;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 100px 1fr;
        gap: 15px;
        align-items: center;
      }
      .form-grid label {
        font-weight: 700;
        color: var(--color-text-muted);
      }
      .form-grid input,
      .form-grid select,
      .form-grid textarea {
        width: 100%;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--color-text-muted);
        color: var(--color-text);
        padding: 10px;
        font-family: var(--font-family);
        font-size: 1rem;
        border-radius: 5px;
        transition: all 0.2s ease;
      }
      .form-grid input:focus,
      .form-grid select:focus,
      .form-grid textarea:focus {
        outline: none;
        border-color: var(--color-accent-primary);
        box-shadow: 0 0 8px var(--color-accent-secondary);
        background: rgba(0, 0, 0, 0.7);
      }
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }
      .data-table th,
      .data-table td {
        padding: 10px 12px;
        text-align: right;
        border-bottom: 1px solid var(--color-border-glass);
      }
      .data-table th {
        background: rgba(0, 0, 0, 0.3);
        color: var(--color-accent-primary);
      }
      .data-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      .win-btn {
        background: linear-gradient(135deg, var(--color-accent-primary), var(--color-accent-secondary));
        border: none;
        color: #fff;
        padding: 10px 15px;
        font-family: var(--font-family);
        font-weight: 700;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s;
        border-radius: 5px;
        margin: 10px 5px 0 0;
      }
      .win-btn:hover {
        background: linear-gradient(135deg, var(--color-accent-secondary), var(--color-accent-primary));
        transform: translateY(-2px);
        box-shadow: 0 0 15px var(--color-accent-secondary);
      }
      .win-btn-danger {
        background: var(--color-accent-red);
      }
      .win-btn-danger:hover {
        background: #ff5555;
      }
      .audit-log {
        font-family: var(--font-mono);
        color: var(--color-text);
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 5px;
        height: 100%;
        overflow-y: auto;
      }

      /* --- 2.4 The "Nexus" (Command Center) --- */
      #nexus {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 600px;
        background: var(--color-bg-glass);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 2px solid var(--color-accent-primary);
        border-radius: 12px;
        box-shadow: var(--shadow-depth-lg), 0 0 25px var(--color-accent-secondary);
        z-index: 2000;
        padding: 20px;
        display: none;
        animation: nexus-pulse 0.7s ease-out;
      }
      @keyframes nexus-pulse {
        from {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }
      #nexus h3 {
        text-align: center;
        color: var(--color-accent-primary);
        margin-bottom: 15px;
      }
      #nexus-input {
        width: 100%;
        padding: 15px;
        font-family: var(--font-family);
        font-size: 1.2rem;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid var(--color-border-glass);
        border-radius: 8px;
        color: var(--color-text);
        text-align: right;
        transition: all 0.2s ease;
      }
      #nexus-input:focus {
        outline: none;
        border-color: var(--color-accent-primary);
        box-shadow: 0 0 12px var(--color-accent-secondary);
        background: rgba(0, 0, 0, 0.7);
      }
      #nexus-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
        z-index: 1999;
        display: none;
      }

      /* --- 2.5 Floating Action Buttons (FAB) - Hierarchical System --- */
      #fab-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 900;
        pointer-events: none;
      }

      /* Base FAB (all levels) */
      .fab {
        position: absolute;
        display: none;
        z-index: 901;
        pointer-events: auto;
      }

      /* FAB Button */
      .fab-button {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      /* Glossy overlay */
      .fab-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.3) 0%,
          transparent 50%,
          rgba(0, 0, 0, 0.3) 100%
        );
        pointer-events: none;
        border-radius: 50%;
      }

      /* Glass reflection */
      .fab-button::after {
        content: "";
        position: absolute;
        top: -10px;
        left: -10px;
        width: 32px;
        height: 32px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.5) 0%,
          transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
        filter: blur(6px);
      }

      .fab-button svg {
        width: 32px;
        height: 32px;
        stroke: #fff;
        stroke-width: 2;
        pointer-events: none;
        filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
        position: relative;
        z-index: 1;
      }

      .fab-button:hover {
        transform: scale(1.1);
      }

      /* Module-specific colors */
      .fab[data-module="hrm"] .fab-button {
        background: linear-gradient(
          135deg,
          rgb(147, 51, 234) 0%,
          rgb(126, 34, 206) 100%
        );
      }
      .fab[data-module="hrm"] .fab-button:hover {
        box-shadow: 0 20px 60px rgba(147, 51, 234, 0.6),
          0 0 40px rgba(147, 51, 234, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      .fab[data-module="prj"] .fab-button {
        background: linear-gradient(
          135deg,
          rgb(5, 150, 105) 0%,
          rgb(4, 120, 87) 100%
        );
      }
      .fab[data-module="prj"] .fab-button:hover {
        box-shadow: 0 20px 60px rgba(5, 150, 105, 0.6),
          0 0 40px rgba(5, 150, 105, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      .fab[data-module="fin"] .fab-button {
        background: linear-gradient(
          135deg,
          rgb(217, 119, 6) 0%,
          rgb(180, 83, 9) 100%
        );
      }
      .fab[data-module="fin"] .fab-button:hover {
        box-shadow: 0 20px 60px rgba(217, 119, 6, 0.6),
          0 0 40px rgba(217, 119, 6, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      .fab[data-module="sys"] .fab-button {
        background: linear-gradient(
          135deg,
          rgb(8, 145, 178) 0%,
          rgb(21, 94, 117) 100%
        );
      }
      .fab[data-module="sys"] .fab-button:hover {
        box-shadow: 0 20px 60px rgba(8, 145, 178, 0.6),
          0 0 40px rgba(8, 145, 178, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3);
      }

      /* Ray container */
      .fab-rays {
        position: absolute;
        top: 32px;
        left: 32px;
        pointer-events: none;
      }

      /* Individual ray */
      .fab-ray {
        position: absolute;
        transform-origin: 0 0;
        pointer-events: auto;
        opacity: 0;
        transform: scale(0);
        transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      }

      /* Show rays on hover */
      .fab:hover .fab-ray {
        opacity: 1;
        transform: scale(1);
      }

      /* Staggered animation delays */
      .fab-ray:nth-child(1) {
        transition-delay: 0.05s;
      }
      .fab-ray:nth-child(2) {
        transition-delay: 0.1s;
      }
      .fab-ray:nth-child(3) {
        transition-delay: 0.15s;
      }
      .fab-ray:nth-child(4) {
        transition-delay: 0.2s;
      }
      .fab-ray:nth-child(5) {
        transition-delay: 0.25s;
      }
      .fab-ray:nth-child(6) {
        transition-delay: 0.3s;
      }

      /* Ray button */
      .fab-ray-button {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.95);
      }

      .fab-ray-button::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          rgba(255, 255, 255, 0.6) 0%,
          transparent 50%,
          rgba(0, 0, 0, 0.1) 100%
        );
        pointer-events: none;
        border-radius: 50%;
      }

      .fab-ray-button::after {
        content: "";
        position: absolute;
        top: -6px;
        left: -6px;
        width: 20px;
        height: 20px;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.8) 0%,
          transparent 70%
        );
        border-radius: 50%;
        pointer-events: none;
        filter: blur(4px);
      }

      .fab-ray-button svg {
        width: 24px;
        height: 24px;
        stroke-width: 2;
        filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.3));
        position: relative;
        z-index: 1;
      }

      /* Color inheritance from parent module */
      .fab[data-module="hrm"] .fab-ray-button svg {
        stroke: rgb(147, 51, 234);
      }
      .fab[data-module="prj"] .fab-ray-button svg {
        stroke: rgb(5, 150, 105);
      }
      .fab[data-module="fin"] .fab-ray-button svg {
        stroke: rgb(217, 119, 6);
      }
      .fab[data-module="sys"] .fab-ray-button svg {
        stroke: rgb(8, 145, 178);
      }

      .fab-ray-button:hover {
        transform: scale(1.15);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.8);
      }

      /* Ray label */
      .fab-ray-label {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        padding: 4px 10px;
        border-radius: 6px;
        font-size: 0.75rem;
        font-family: var(--font-family);
        white-space: nowrap;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .fab-ray-button:hover + .fab-ray-label {
        opacity: 1;
      }

      /* Level 2 FAB (spawned from ray click) - smaller */
      .fab[data-level="2"] .fab-button {
        width: 52px;
        height: 52px;
      }

      .fab[data-level="2"] .fab-button svg {
        width: 26px;
        height: 26px;
      }

      .fab[data-level="2"] .fab-ray-button {
        width: 40px;
        height: 40px;
      }
    </style>
  </head>

  <body>
    <!-- 1. BOOT SCREEN -->
    <div id="boot-screen">
      <!-- Particle Orb Background -->
      <div class="particle-orbs">
        <div class='wrap'>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
          <div class='c'></div>
        </div>
      </div>
      
      <div id="boot-log">
        <p>NIJJARA-OS v1.0</p>
        <p>Copyright (c) 2024 Nijjara Systems</p>
        <p>For Contracting & Woodcrafts</p>
        <p>----------------------------------------</p>
        <p>Initializing neural interface...</p>
        <p>Loading system modules...</p>
        <p>Authenticating user...</p>
      </div>
      
      <!-- 3D Cube Login Form -->
      <div class="login-box-3d" id="loginBox">
        <div class='control'>
          <h1>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          </h1>
        </div>
        <div class='control block-cube block-input'>
          <input type='text' id="loginUser" placeholder='Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' autocomplete="username">
          <div class='bg-top'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg-right'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg'>
            <div class='bg-inner'></div>
          </div>
        </div>
        <div class='control block-cube block-input'>
          <input type='password' id="loginPass" placeholder='ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' autocomplete="current-password">
          <div class='bg-top'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg-right'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg'>
            <div class='bg-inner'></div>
          </div>
        </div>
        <button class='btn block-cube block-cube-hover' type='button' onclick="handleLogin()">
          <div class='bg-top'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg-right'>
            <div class='bg-inner'></div>
          </div>
          <div class='bg'>
            <div class='bg-inner'></div>
          </div>
          <div class='text'>
            Ø¯Ø®ÙˆÙ„
          </div>
        </button>
        <div id="login-feedback"></div>
      </div>
      </div>
    </div>

    <!-- 2. NIJJARA-OS DESKTOP -->
    <div id="nijjara-os">
      <div id="holo-deck">
      <div class="particle-desktop-bg">
        <div class="wrap">
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
          <div class="c"></div>
        </div>
      </div>
    </div>

      <!-- Windows Container -->
      <div id="windows-container"></div>

      <!-- Nexus (Command Center) -->
      <div id="nexus-overlay"></div>
      <div id="nexus">
        <h3>Ø§Ù„Ù†ÙƒØ³Ø³ - Ù…Ø±ÙƒØ² Ø§Ù„ØªØ­ÙƒÙ…</h3>
        <input
          type="text"
          id="nexus-input"
          placeholder="Ø§ÙƒØªØ¨ Ø£Ù…Ø±Ù‹Ø§ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø±..."
          onkeypress="if(event.key==='Enter'){executeNexusCommand()}"
        />
      </div>

      <!-- FAB Container -->
      <div id="fab-container"></div>
    </div>

    <script>
      // =========================================================
      // NIJJARA-OS v1.0 - MAIN JAVASCRIPT
      // =========================================================

      // --- Global State ---
      const state = {
        authenticated: false,
        currentUser: null,
        windows: new Map(), // windowId -> {element, module, type, data}
        activeWindow: null,
        windowZIndex: 10,
        nexusVisible: false,
        fabModules: new Map(),
      };

      // --- Module Definitions ---
      const modules = {
        hrm: {
          name: 'Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©',
          icon: 'ðŸ‘¥',
          color: '#9333ea',
          position: { x: 100, y: 100 },
          actions: [
            { id: 'employees', name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†', icon: 'ðŸ‘¤' },
            { id: 'attendance', name: 'Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù', icon: 'ðŸ“…' },
            { id: 'payroll', name: 'Ø§Ù„Ø±ÙˆØ§ØªØ¨', icon: 'ðŸ’°' }
          ]
        },
        prj: {
          name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹',
          icon: 'ðŸ“Š',
          color: '#059669',
          position: { x: 200, y: 100 },
          actions: [
            { id: 'projects', name: 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹', icon: 'ðŸ“‹' },
            { id: 'tasks', name: 'Ø§Ù„Ù…Ù‡Ø§Ù…', icon: 'âœ…' },
            { id: 'timeline', name: 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ', icon: 'ðŸ“…' }
          ]
        },
        fin: {
          name: 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ',
          icon: 'ðŸ’°',
          color: '#d97706',
          position: { x: 300, y: 100 },
          actions: [
            { id: 'accounts', name: 'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª', icon: 'ðŸ“Š' },
            { id: 'transactions', name: 'Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª', icon: 'ðŸ’³' },
            { id: 'reports', name: 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', icon: 'ðŸ“ˆ' }
          ]
        },
        sys: {
          name: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…',
          icon: 'âš™ï¸',
          color: '#0891b2',
          position: { x: 400, y: 100 },
          actions: [
            { id: 'users', name: 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', icon: 'ðŸ‘¥' },
            { id: 'permissions', name: 'Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª', icon: 'ðŸ”' },
            { id: 'settings', name: 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', icon: 'âš™ï¸' }
          ]
        }
      };

      // --- Boot Sequence ---
      function boot() {
        const bootLog = document.getElementById('boot-log');
        const loginBox = document.getElementById('loginBox');
        
        setTimeout(() => {
          bootLog.innerHTML += '<p>âœ“ System ready</p>';
          loginBox.style.display = 'flex';
          document.getElementById('loginUser').focus();
        }, 2000);
      }

      // --- Authentication ---
      function handleLogin() {
        const username = document.getElementById('loginUser').value;
        const password = document.getElementById('loginPass').value;
        const feedback = document.getElementById('login-feedback');

        if (!username || !password) {
          feedback.textContent = 'ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
          return;
        }

        feedback.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';

        google.script.run
          .withSuccessHandler(function(response) {
            console.log('Login response:', response);
            
            if (response && response.success) {
              state.authenticated = true;
              state.currentUser = response.data;
              feedback.textContent = 'âœ“ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­';
              
              // Store session
              try {
                sessionStorage.setItem('nijjara_session', JSON.stringify(response.data));
                sessionStorage.setItem('nijjara_login_success', 'true');
                console.log('Session stored successfully');
              } catch (e) {
                console.error('Failed to store session:', e);
                feedback.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©';
                return;
              }
              
              setTimeout(() => {
                showDesktop();
              }, 1000);
            } else {
              feedback.textContent = response.message || 'ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
              document.getElementById('loginPass').value = '';
            }
          })
          .withFailureHandler(function(error) {
            console.error('Login error:', error);
            feedback.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message;
          })
          .authenticateUser(username, password);
      }

      // --- Desktop Interface ---
      function showDesktop() {
        const bootScreen = document.getElementById('boot-screen');
        const nijjaraOS = document.getElementById('nijjara-os');
        
        if (!bootScreen || !nijjaraOS) {
          console.error('Critical elements not found!');
          return;
        }
        
        // Fade out boot screen
        bootScreen.style.opacity = '0';
        bootScreen.style.visibility = 'hidden';
        
        // Show desktop with slight delay for smooth transition
        setTimeout(() => {
          nijjaraOS.style.display = 'block';
          
          // Initialize desktop components
          initializeFABs();
          initializeNexus();
          
          console.log('Desktop loaded successfully');
        }, 300);
      }

      // --- FAB System ---
      function initializeFABs() {
        const container = document.getElementById('fab-container');
        
        Object.entries(modules).forEach(([moduleId, module]) => {
          const fabElement = createFAB(moduleId, module, 1);
          container.appendChild(fabElement);
          state.fabModules.set(moduleId, fabElement);
        });
      }

      function createFAB(moduleId, module, level) {
        const fab = document.createElement('div');
        fab.className = 'fab';
        fab.setAttribute('data-module', moduleId);
        fab.setAttribute('data-level', level);
        fab.style.left = module.position.x + 'px';
        fab.style.top = module.position.y + 'px';

        const button = document.createElement('div');
        button.className = 'fab-button';
        button.innerHTML = module.icon;
        button.title = module.name;
        
        button.addEventListener('click', () => {
          if (level === 1) {
            toggleRays(fab, moduleId, module);
          }
        });

        fab.appendChild(button);
        return fab;
      }

      function toggleRays(fab, moduleId, module) {
        const existingRays = fab.querySelector('.fab-rays');
        
        if (existingRays) {
          existingRays.remove();
          return;
        }

        const raysContainer = document.createElement('div');
        raysContainer.className = 'fab-rays';

        module.actions.forEach((action, index) => {
          const angle = (index * 60) - 90; // Spread rays in arc
          const distance = 80;
          const x = Math.cos(angle * Math.PI / 180) * distance;
          const y = Math.sin(angle * Math.PI / 180) * distance;

          const ray = document.createElement('div');
          ray.className = 'fab-ray';
          ray.style.transform = `translate(${x}px, ${y}px)`;

          const rayButton = document.createElement('div');
          rayButton.className = 'fab-ray-button';
          rayButton.innerHTML = action.icon;
          rayButton.title = action.name;
          
          rayButton.addEventListener('click', () => {
            openWindow(moduleId, action.id, action.name);
            toggleRays(fab, moduleId, module); // Close rays after click
          });

          const label = document.createElement('div');
          label.className = 'fab-ray-label';
          label.textContent = action.name;
          label.style.transform = `translate(-50%, -40px)`;
          label.style.left = '50%';

          ray.appendChild(rayButton);
          ray.appendChild(label);
          raysContainer.appendChild(ray);
        });

        fab.appendChild(raysContainer);
      }

      // --- Window System ---
      function openWindow(moduleId, actionId, title) {
        const windowId = `${moduleId}-${actionId}-${Date.now()}`;
        
        // Check if window already exists
        const existingWindow = Array.from(state.windows.values()).find(w => 
          w.module === moduleId && w.type === actionId
        );
        
        if (existingWindow) {
          // Focus existing window
          existingWindow.element.style.zIndex = ++state.windowZIndex;
          return;
        }

        const windowElement = createWindow(windowId, title, moduleId, actionId);
        document.getElementById('windows-container').appendChild(windowElement);
        
        state.windows.set(windowId, {
          element: windowElement,
          module: moduleId,
          type: actionId,
          data: {}
        });

        // Load content based on module and action
        loadWindowContent(windowId, moduleId, actionId);
      }

      function createWindow(windowId, title, moduleId, actionId) {
        const window = document.createElement('div');
        window.className = 'app-window';
        window.id = windowId;
        window.style.zIndex = ++state.windowZIndex;
        window.style.top = '50px';
        window.style.left = '50px';

        window.innerHTML = `
          <div class="window-header">
            <div class="window-controls-left">
              <button class="btn-min" onclick="minimizeWindow('${windowId}')" title="ØªØµØºÙŠØ±">âˆ’</button>
              <button class="btn-max" onclick="maximizeWindow('${windowId}')" title="ØªÙƒØ¨ÙŠØ±">â–¡</button>
            </div>
            <div class="window-title">${title}</div>
            <div class="window-controls-right">
              <button class="btn-close" onclick="closeWindow('${windowId}')" title="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
            </div>
          </div>
          <div class="window-content" id="content-${windowId}">
            <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
          </div>
        `;

        // Make window draggable
        makeDraggable(window);
        
        return window;
      }

      function makeDraggable(element) {
        const header = element.querySelector('.window-header');
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        header.addEventListener('mousedown', dragStart);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', dragEnd);

        function dragStart(e) {
          initialX = e.clientX - xOffset;
          initialY = e.clientY - yOffset;

          if (e.target === header || header.contains(e.target)) {
            isDragging = true;
            element.style.zIndex = ++state.windowZIndex;
          }
        }

        function drag(e) {
          if (isDragging) {
            e.preventDefault();
            currentX = e.clientX - initialX;
            currentY = e.clientY - initialY;
            xOffset = currentX;
            yOffset = currentY;

            element.style.transform = `translate(${currentX}px, ${currentY}px)`;
          }
        }

        function dragEnd(e) {
          initialX = currentX;
          initialY = currentY;
          isDragging = false;
        }
      }

      function loadWindowContent(windowId, moduleId, actionId) {
        const content = document.getElementById(`content-${windowId}`);
        
        // Simulate loading content based on module and action
        setTimeout(() => {
          switch (moduleId) {
            case 'hrm':
              loadHRMContent(content, actionId);
              break;
            case 'prj':
              loadPRJContent(content, actionId);
              break;
            case 'fin':
              loadFINContent(content, actionId);
              break;
            case 'sys':
              loadSYSContent(content, actionId);
              break;
            default:
              content.innerHTML = '<p>Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± Ù…ØªØ§Ø­</p>';
          }
        }, 500);
      }

      function loadHRMContent(content, actionId) {
        switch (actionId) {
          case 'employees':
            content.innerHTML = `
              <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
              <div class="form-grid">
                <label>Ø§Ù„Ø§Ø³Ù…:</label>
                <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù" />
                <label>Ø§Ù„Ù‚Ø³Ù…:</label>
                <select>
                  <option>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                  <option>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</option>
                  <option>Ø§Ù„ØªØ³ÙˆÙŠÙ‚</option>
                  <option>Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                </select>
              </div>
              <button class="win-btn">Ø¨Ø­Ø«</button>
              <button class="win-btn">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Ø§Ù„Ø§Ø³Ù…</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</td>
                    <td>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</td>
                    <td>Ù†Ø´Ø·</td>
                  </tr>
                </tbody>
              </table>
            `;
            break;
          case 'attendance':
            content.innerHTML = `
              <h3>Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h3>
              <p>Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</p>
              <div style="text-align: center; margin: 20px;">
                <button class="win-btn" style="font-size: 18px; padding: 15px 30px;">
                  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±
                </button>
                <button class="win-btn" style="font-size: 18px; padding: 15px 30px;">
                  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù
                </button>
              </div>
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„Ø­Ø¶ÙˆØ±</th>
                    <th>Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>2024-01-15</td>
                    <td>08:30</td>
                    <td>17:30</td>
                  </tr>
                </tbody>
              </table>
            `;
            break;
          case 'payroll':
            content.innerHTML = `
              <h3>Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3>
              <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§ØªØ¨ ÙˆØ§Ù„Ù…Ø³ØªØ­Ù‚Ø§Øª</p>
              <div class="form-grid">
                <label>Ø§Ù„Ø´Ù‡Ø±:</label>
                <select>
                  <option>ÙŠÙ†Ø§ÙŠØ± 2024</option>
                  <option>ÙØ¨Ø±Ø§ÙŠØ± 2024</option>
                </select>
              </div>
              <button class="win-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§ØªØ¨</button>
              <button class="win-btn">Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø±Ø§ØªØ¨</button>
            `;
            break;
        }
      }

      function loadPRJContent(content, actionId) {
        switch (actionId) {
          case 'projects':
            content.innerHTML = `
              <h3>Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h3>
              <div class="form-grid">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</label>
                <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹" />
              </div>
              <button class="win-btn">Ø¨Ø­Ø«</button>
              <button class="win-btn">Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±ÙˆØ¹</button>
            `;
            break;
          case 'tasks':
            content.innerHTML = `
              <h3>Ø§Ù„Ù…Ù‡Ø§Ù…</h3>
              <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©</p>
              <button class="win-btn">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
            `;
            break;
          case 'timeline':
            content.innerHTML = `
              <h3>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h3>
              <p>Ù…Ø®Ø·Ø· Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</p>
            `;
            break;
        }
      }

      function loadFINContent(content, actionId) {
        switch (actionId) {
          case 'accounts':
            content.innerHTML = `
              <h3>Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</h3>
              <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
              <button class="win-btn">Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</button>
            `;
            break;
          case 'transactions':
            content.innerHTML = `
              <h3>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h3>
              <p>Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
              <button class="win-btn">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù…Ù„Ø©</button>
            `;
            break;
          case 'reports':
            content.innerHTML = `
              <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
              <p>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</p>
              <button class="win-btn">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø±Ø¨Ø§Ø­ ÙˆØ§Ù„Ø®Ø³Ø§Ø¦Ø±</button>
              <button class="win-btn">Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„Ø¹Ù…ÙˆÙ…ÙŠØ©</button>
            `;
            break;
        }
      }

      function loadSYSContent(content, actionId) {
        switch (actionId) {
          case 'users':
            content.innerHTML = `
              <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
              <div class="form-grid">
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
                <input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" />
              </div>
              <button class="win-btn">Ø¨Ø­Ø«</button>
              <button class="win-btn">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…</button>
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                    <th>Ø§Ù„Ø¯ÙˆØ±</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>admin</td>
                    <td>admin@nijjara.com</td>
                    <td>Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</td>
                    <td>Ù†Ø´Ø·</td>
                  </tr>
                </tbody>
              </table>
            `;
            break;
          case 'permissions':
            content.innerHTML = `
              <h3>Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
              <p>Ø¥Ø¯Ø§Ø±Ø© ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
              <button class="win-btn">Ø¹Ø±Ø¶ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</button>
            `;
            break;
          case 'settings':
            content.innerHTML = `
              <h3>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
              <p>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
              <button class="win-btn">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</button>
              <button class="win-btn">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†</button>
            `;
            break;
        }
      }

      function closeWindow(windowId) {
        const window = state.windows.get(windowId);
        if (window) {
          window.element.remove();
          state.windows.delete(windowId);
        }
      }

      function minimizeWindow(windowId) {
        const window = state.windows.get(windowId);
        if (window) {
          window.element.style.display = 'none';
        }
      }

      function maximizeWindow(windowId) {
        const window = state.windows.get(windowId);
        if (window) {
          const element = window.element;
          if (element.style.width === '100vw') {
            // Restore
            element.style.width = '600px';
            element.style.height = '400px';
            element.style.top = '50px';
            element.style.left = '50px';
          } else {
            // Maximize
            element.style.width = '100vw';
            element.style.height = '100vh';
            element.style.top = '0';
            element.style.left = '0';
          }
        }
      }

      // --- Nexus System ---
      function initializeNexus() {
        const nexusOverlay = document.getElementById('nexus-overlay');
        const nexus = document.getElementById('nexus');
        
        // Close nexus when clicking overlay
        nexusOverlay.addEventListener('click', () => {
          hideNexus();
        });

        // Keyboard shortcut for nexus
        document.addEventListener('keydown', (e) => {
          if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            toggleNexus();
          }
        });
      }

      function toggleNexus() {
        if (state.nexusVisible) {
          hideNexus();
        } else {
          showNexus();
        }
      }

      function showNexus() {
        document.getElementById('nexus-overlay').style.display = 'block';
        document.getElementById('nexus').style.display = 'block';
        document.getElementById('nexus-input').focus();
        state.nexusVisible = true;
      }

      function hideNexus() {
        document.getElementById('nexus-overlay').style.display = 'none';
        document.getElementById('nexus').style.display = 'none';
        document.getElementById('nexus-input').value = '';
        state.nexusVisible = false;
      }

      function executeNexusCommand() {
        const input = document.getElementById('nexus-input');
        const command = input.value.trim();
        
        if (!command) return;

        // Simple command parser
        const parts = command.split(' ');
        const action = parts[0];
        
        switch (action) {
          case 'Ù…ÙˆØ¸ÙÙŠÙ†':
          case 'employees':
            openWindow('hrm', 'employees', 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            break;
          case 'Ù…Ø´Ø§Ø±ÙŠØ¹':
          case 'projects':
            openWindow('prj', 'projects', 'Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹');
            break;
          case 'Ø­Ø³Ø§Ø¨Ø§Øª':
          case 'accounts':
            openWindow('fin', 'accounts', 'Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª');
            break;
          case 'Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†':
          case 'users':
            openWindow('sys', 'users', 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            break;
          case 'Ù…Ø³Ø§Ø¹Ø¯Ø©':
          case 'help':
            alert('Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©:\nÙ…ÙˆØ¸ÙÙŠÙ† - ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†\nÙ…Ø´Ø§Ø±ÙŠØ¹ - ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹\nØ­Ø³Ø§Ø¨Ø§Øª - ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©\nÙ…Ø³ØªØ®Ø¯Ù…ÙŠÙ† - ÙØªØ­ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†');
            break;
          default:
            alert('Ø£Ù…Ø± ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ. Ø§ÙƒØªØ¨ "Ù…Ø³Ø§Ø¹Ø¯Ø©" Ù„Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©');
        }
        
        hideNexus();
      }

      // --- Keyboard Shortcuts ---
      document.addEventListener('keydown', (e) => {
        // Nexus shortcut (already handled above)
        
        // Module shortcuts
        if (e.ctrlKey) {
          switch (e.key) {
            case '1':
              e.preventDefault();
              toggleRays(state.fabModules.get('hrm'), 'hrm', modules.hrm);
              break;
            case '2':
              e.preventDefault();
              toggleRays(state.fabModules.get('prj'), 'prj', modules.prj);
              break;
            case '3':
              e.preventDefault();
              toggleRays(state.fabModules.get('fin'), 'fin', modules.fin);
              break;
            case '4':
              e.preventDefault();
              toggleRays(state.fabModules.get('sys'), 'sys', modules.sys);
              break;
          }
        }
      });

      // --- Initialization ---
      window.addEventListener('load', () => {
        // Check for URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const hasToken = urlParams.has('token');
        const loginSuccess = sessionStorage.getItem('nijjara_login_success');
        
        // Check for existing session
        const session = sessionStorage.getItem('nijjara_session');
        
        if (session) {
          try {
            const userData = JSON.parse(session);
            state.authenticated = true;
            state.currentUser = userData;
            
            // Clear login success flag
            sessionStorage.removeItem('nijjara_login_success');
            
            // Show desktop immediately if coming from login
            if (hasToken || loginSuccess === 'true') {
              showDesktop();
            } else {
              // Validate session with server before showing desktop
              validateSessionAndShow(userData);
            }
          } catch (e) {
            console.error('Session parse error:', e);
            // Invalid session, show login
            sessionStorage.clear();
            boot();
          }
        } else {
          // No session found
          boot();
        }
      });
      
      // Validate session with server (optional - can be implemented later)
      function validateSessionAndShow(userData) {
        // For now, just show desktop
        // TODO: Add server-side session validation
        showDesktop();
      }

      // Handle Enter key in login form
      document.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !state.authenticated) {
          const loginBox = document.getElementById('loginBox');
          if (loginBox.style.display === 'flex') {
            handleLogin();
          }
        }
      });
    </script>
  </body>
</html>
