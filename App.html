<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Nijjara ERP - نظام إدارة نجارة</title>
  
  <!-- IMMEDIATE DEBUG -->
  <script>
    console.log('=== App.html HEAD is loading ===');
    console.log('Document:', document);
  </script>
  
  <!-- Preload Critical Resources -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  
  <!-- Cairo Font Family -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Include CSS -->
  <?!= include('CSS'); ?>
  
  <script>
    console.log('=== CSS should be loaded ===');
  </script>
</head>
<body>
  
  <script>
    console.log('=== BODY tag reached ===');
    console.log('Body background:', getComputedStyle(document.body).backgroundColor);
  </script>
  
  <!-- ============================================ -->
  <!-- LOADING SCREEN -->
  <!-- ============================================ -->
  <div id="loading-screen" class="loading-screen" role="status" aria-live="polite">
    <div class="loading-content">
      <div class="loader"></div>
      <h2>Nijjara ERP</h2>
      <p class="loading-text">جاري التحميل...</p>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- TOAST NOTIFICATION CONTAINER -->
  <!-- ============================================ -->
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>

  <!-- ============================================ -->
  <!-- LOGIN VIEW -->
  <!-- ============================================ -->
  <div id="login-view" class="hidden">
    <div class="login-container">
      <div class="login-card">
        <!-- Logo/Brand -->
        <div class="login-header">
          <span class="material-icons login-icon">account_balance</span>
          <h1>Nijjara ERP</h1>
          <p class="login-subtitle">نظام إدارة الأعمال المتكامل</p>
        </div>

        <!-- Login Form -->
        <form id="login-form" class="login-form" novalidate>
          <!-- Username Field -->
          <div class="form-group">
            <label for="username">
              <span class="material-icons">person</span>
              اسم المستخدم
            </label>
            <input 
              type="text" 
              id="username" 
              name="username" 
              autocomplete="username"
              required 
              placeholder="أدخل اسم المستخدم"
              aria-label="اسم المستخدم"
              aria-required="true">
            <span class="error-message" id="username-error" role="alert"></span>
          </div>

          <!-- Password Field -->
          <div class="form-group">
            <label for="password">
              <span class="material-icons">lock</span>
              كلمة المرور
            </label>
            <div class="password-input-wrapper">
              <input 
                type="password" 
                id="password" 
                name="password"
                autocomplete="current-password" 
                required
                placeholder="أدخل كلمة المرور"
                aria-label="كلمة المرور"
                aria-required="true">
              <button 
                type="button" 
                class="toggle-password" 
                id="toggle-password"
                aria-label="إظهار/إخفاء كلمة المرور">
                <span class="material-icons">visibility</span>
              </button>
            </div>
            <span class="error-message" id="password-error" role="alert"></span>
          </div>

          <!-- Remember Me -->
          <div class="form-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" id="remember-me" name="remember-me">
              <span>تذكرني</span>
            </label>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary btn-login" id="login-button">
            <span class="btn-text">تسجيل الدخول</span>
            <span class="btn-loader" style="display: none;">
              <span class="spinner"></span>
            </span>
          </button>

          <!-- Form Error -->
          <div class="form-error" id="login-error" role="alert" style="display: none;"></div>
        </form>

        <!-- Footer -->
        <div class="login-footer">
          <p>Nijjara ERP &copy; 2025</p>
          <p class="version">Version 1.0.0</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ============================================ -->
  <!-- WORKSPACE VIEW (After Login) -->
  <!-- ============================================ -->
  <div id="workspace-view" class="view" style="display: none;">
    
    <!-- Top Navigation Bar -->
    <nav class="top-nav" role="navigation">
      <div class="nav-content">
        <!-- Left Section -->
        <div class="nav-left">
          <button class="menu-toggle" id="menu-toggle" aria-label="فتح/إغلاق القائمة">
            <span class="material-icons">menu</span>
          </button>
          <h1 class="app-title">
            <span class="material-icons">account_balance</span>
            Nijjara ERP
          </h1>
        </div>

        <!-- Right Section -->
        <div class="nav-right">
          <!-- User Info -->
          <div class="user-info">
            <span class="user-name" id="user-display-name">...</span>
            <span class="user-role" id="user-role">...</span>
          </div>
          
          <!-- User Menu -->
          <div class="user-menu-wrapper">
            <button class="user-menu-button" id="user-menu-button" aria-label="قائمة المستخدم" aria-haspopup="true">
              <span class="material-icons">account_circle</span>
            </button>
            <div class="user-menu" id="user-menu" style="display: none;">
              <a href="#" class="menu-item" id="menu-profile">
                <span class="material-icons">person</span>
                الملف الشخصي
              </a>
              <a href="#" class="menu-item" id="menu-settings">
                <span class="material-icons">settings</span>
                الإعدادات
              </a>
              <hr class="menu-divider">
              <a href="#" class="menu-item" id="menu-logout">
                <span class="material-icons">logout</span>
                تسجيل الخروج
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content Area -->
    <div class="workspace-container">
      
      <!-- Sidebar Navigation -->
      <aside class="sidebar" id="sidebar" role="complementary">
        <div class="sidebar-content">
          <h2 class="sidebar-title">القوائم الرئيسية</h2>
          
          <!-- Navigation will be dynamically populated -->
          <nav class="sidebar-nav" id="sidebar-nav">
            <p class="loading-text">جاري تحميل القوائم...</p>
          </nav>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-content" id="main-content" role="main">
        <div class="content-container">
          <h2>مرحباً بك في Nijjara ERP</h2>
          <p>اختر قائمة من الشريط الجانبي للبدء</p>
        </div>
      </main>

    </div>
  </div>

  <!-- ============================================ -->
  <!-- SCRIPTS -->
  <!-- ============================================ -->
  
  <!-- Global Utilities & Error Handling -->
  <?!= include('JS_Global'); ?>
  
  <!-- Server Communication Wrapper -->
  <?!= include('JS_Server'); ?>
  
  <!-- Login Logic -->
  <?!= include('JS_Login'); ?>

  <!-- App Initialization -->
  <script>
    // Simple debug log
    console.log('=== Nijjara ERP: App.html loaded ===');
    console.log('Document ready state:', document.readyState);
    
    // App initialization when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('=== DOM Content Loaded ===');
      
      // Check if functions exist
      console.log('Logger exists:', typeof Logger !== 'undefined');
      console.log('hideLoading exists:', typeof hideLoading !== 'undefined');
      console.log('checkSession exists:', typeof checkSession !== 'undefined');
      
      if (typeof Logger !== 'undefined') {
        Logger.info('App', 'DOM Content Loaded - Initializing application');
      }
      
      // Hide loading screen
      if (typeof hideLoading !== 'undefined') {
        hideLoading();
      } else {
        console.error('hideLoading function not found!');
        // Manual fallback
        const loadingEl = document.getElementById('loading-screen');
        if (loadingEl) {
          loadingEl.classList.add('hidden');
        }
      }
      
      // Check if user has active session
      if (typeof checkSession !== 'undefined') {
        checkSession();
      } else {
        console.error('checkSession function not found!');
        // Show login view as fallback
        const loginView = document.getElementById('login-view');
        if (loginView) {
          loginView.style.display = 'block';
        }
      }
      
      console.log('=== Application initialized ===');
    });
  </script>

</body>
</html>
